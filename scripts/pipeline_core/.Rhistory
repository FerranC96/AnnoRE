ls()
View(merged)
snp_file <- read.table("~/MSc/Project_3/MSc_Project3/scripts/pipeline_core/output/snp_file.txt", quote="\"", comment.char="")
snp_file
library(XGR)
test_Enrich <- xEnricherSNPs(snp_file)
snp_INPUTVECTOR <- as.vector(snp_file[,1])
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR)
ls()
test_Enrich
class(test_Enrich)
snp_file <- read.table("../../example_input/OCD_GWAS_SIGNIFICANT_SNP_RSIDs_all.txt", quote="\"", comment.char="")
snp_INPUTVECTOR <- as.vector(snp_file[,1])
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR)
test_Enrich
test_Enrich$g
test_Enrich$data
test_Enrich$term_info
xEnrichViewer(test_Enrich)
xEnrichBarplot(test_Enrich)
graph <- xEnrichBarplot(test_Enrich)
graph
snp_INPUTVECTOR
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=3)
xEnrichViewer(test_Enrich)
graph <- xEnrichBarplot(test_Enrich)
graph
test_Enrich
test_Enrich$g
test_Enrich$term_info
ls()
savehistory(file="TestingXGR")
quit()
View(graph)
graph
View(test_Enrich)
library("ggplot2", lib.loc="~/anaconda3/envs/rstudio/lib/R/library")
View(graph)
graph
View(snp_file)
View(test_Enrich)
test_Enrich$term_info
test_Enrich$annotation
test_Enrich$g
test_Enrich$overlap
library(XGR)
enrich_results <- xEnrichViewer(test_Enrich)
enrich_results
quit()
View(enrich_results)
View(test_Enrich)
test_Enrich$term_info
test_Enrich$annotation
test_Enrich$overlap
test_Enrich$fc
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=3, verbose=T)
library(XGR)
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=3, verbose=T)
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=3, verbose=T, ontology="EF")
test_Enrich_hypergeo <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=3, verbose=T, test="hypergeo")
test_Enrich_hypergeo
test_Enrich
test_Enrich <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=2, verbose=T, size.range=c(3,2000))
test_Enrich
ls()
enrich_results <- xEnrichViewer(test_Enrich)
enrich_results
View(enrich_results)
View(xEnrichBarplot(test_Enrich))
xEnrichBarplot(test_Enrich)
bar_test <- xEnrichBarplot(test_Enrich)
bar_test
dag_test <- xEnrichDAGplot(test_Enrich)
dot_test <- xEnrichDotplot(test_Enrich)
dot_test
concis_test <- xEnrichConciser(test_Enrich)
concis_test
dag_test
xEnrichDAGplot(test_Enrich)
xEnrichDAGplotAdv(test_Enrich)
xEnrichDAGplotAdv(dag_test)
xEnrichDAGplotAdv(test_Enrich$g)
xEnrichDAGplotAdv(enrich_results)
quit()
View(bar_test)
bar_test
View(concis_test)
concis_test
dag_test
ggplot2(dag_test)
ggplot2::(dag_test)
library("ggplot2", lib.loc="~/anaconda3/envs/rstudio/lib/R/library")
ggplot(dag_test)
dag_test]
dag_test
View(dag_test)
library("Rgraphviz", lib.loc="~/anaconda3/envs/rstudio/lib/R/library")
dag_test
plot.dag_test
Rgraphviz::plot(dag_test)
View(dot_test)
dot_test
View(enrich_results)
View(graph)
graph
View(merged)
View(snp_file)
View(test_Enrich)
View(enrich_results)
test_Enrich$annotation
View(test_Enrich$annotation)
class(enrich_results)
View(enrich_results)
test_Enrich$data
test_Enrich$annotation
View(enrich_results)
test_Enrich$annotation$`EFO:0000719`
quit()
View(snp_file)
bar_test
View(enrich_results)
haploR_output <- read.delim("./output/OCD_haploR.tsv")
OCD_haploR <- read.delim("~/MSc/Project_3/MSc_Project3/scripts/pipeline_core/output/OCD_haploR.tsv")
View(OCD_haploR)
OCD_haploR <- read.delim("~/MSc/Project_3/MSc_Project3/scripts/pipeline_core/output/OCD_haploR.tsv", row.names=NULL)
View(OCD_haploR)
OCD <- read.delim("~/MSc/Project_3/MSc_Project3/scripts/pipeline_core/output/OCD.tsv", header=FALSE, comment.char="#")
View(OCD)
OCD <- read.delim("./output/OCD.tsv", comment.char="", skip=58)
View(OCD)
main_haploR <- haploR_output[haploR_output$is_query_snp == 1,]
main_haploR <- subset(main_haploR, select = c(rsID, chr, Proteins, eQTL, Promoter_histone_marks, Enhancer_histone_marks))
vep_output <- read.delim("./output/OCD.tsv", comment.char="", skip=58)
vep_output <- vep_output %>% dplyr::mutate(rsID = str_extract(Existing_variation, pattern = "rs\\d+(?=\\,|$)"))
library(dplyr)
library(stringr)
vep_output <- vep_output %>% dplyr::mutate(rsID = str_extract(Existing_variation, pattern = "rs\\d+(?=\\,|$)"))
merged <- left_join(vep_output, main_haploR, by=c("rsID"))
View(merged)
write.table(merged, file="./output/OCD_main_output.tsv", quote=FALSE, row.names = FALSE, sep="\t")
View(enrich_results)
View(merged)
View(merged)
View(haploR_output)
#reg_biotype <- regulatory_subset %>%  group_by(BIOTYPE) %>% summarise(counts = n_distinct(X.Uploaded_variation))
regulatory_subset %>%
group_by(BIOTYPE) %>%
summarise(counts = n_distinct(X.Uploaded_variation)) %>% #instead of n to count all, since repeated ids
ggplot(aes(x = BIOTYPE, y = counts, fill = BIOTYPE)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Biotype of regulatory feature",
y = "Number of distinct rsIDs",
title = "Test plotting of regulatory features"
)
library(dplyr)
library(stringr)
#reg_Phistone
regulatory_subset %>%
group_by(Promoter_histone_marks) %>%
summarise(counts = n_distinct(X.Uploaded_variation))
View(merged)
x <- queryHaploreg(file="./output/snp_file.txt", ldThresh = 0.9, timeout = 1000)
library(haploR)
#Change output to tsv or similar
write.table(x, file="./output/OCD_haploR.tsv", quote=FALSE, sep="\t")
View(enrich_results)
enrichment <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=2, verbose=T, size.range=c(3,2000))
library(XGR)
enrichment <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=2, verbose=T, size.range=c(3,2000))
enrichment_results <- xEnrichViewer(enrichment, details = T)
View(enrichment_results)
bar_plot <- xEnrichBarplot(enrichment, signature = FALSE)
View(bar_plot)
bar_plot
class(bar_plot)
dot_plot <- xEnrichDotplot(enrichment)
dot_plot
View(bar_plot)
View(snp_file)
saveRDS(bar_plot, file = "./output/Plots/enrich_bar.rds")
saveRDS(dot_plot, file = "./output/Plots/enrich_dot.rds")
?ggsave
ggsave(filename = "./output/Plots/enrich_bar.svg", plot = bar_plot)
library(svglite)
install.packages("svglite")
install.packages("svglite")
library(svglite)
ggsave(filename = "./output/Plots/enrich_bar.svg", plot = bar_plot)
ggsave(filename = "./output/Plots/enrich_dot.rds", plot = dot_plot)
ggsave(filename = "./output/Plots/enrich_dot.svg", plot = dot_plot)
haploR_output <- read.delim("./output/OCD_haploR.tsv", row.names = NULL)
main_haploR <- haploR_output[haploR_output$is_query_snp == 1,]
main_haploR <- subset(main_haploR, select = c(rsID, chr, Proteins, eQTL, Promoter_histone_marks, Enhancer_histone_marks))
vep_output <- read.delim("./output/OCD.tsv", comment.char="", skip=58)
vep_output <- vep_output %>% dplyr::mutate(rsID = str_extract(Existing_variation, pattern = "rs\\d+(?=\\,|$)"))
merged <- left_join(vep_output, main_haploR, by=c("rsID"))
View(merged)
write.table(merged, file="./output/OCD_main_output.tsv", quote=FALSE, row.names = FALSE, sep="\t")
View(main_haploR)
View(vep_output)
?left_join
View(merged)
library(dplyr)
merged_test <- replace_na(merged, list(Proteins = "-", eQTL ="-", Promoter_histone_marks ="-", Enhancer_histone_marks="-"))
install.packages("tidyr")
library(tidyr)
merged_test <- replace_na(merged, list(Proteins = "-", eQTL ="-", Promoter_histone_marks ="-", Enhancer_histone_marks="-"))
View(merged_test)
myList <- setNames(lapply(vector("list", ncol(merged)), function(x) x <- "-"), names(merged))
View(myList)
merged_test <- replace_na(merged, myList)
View(merged_test)
myList <- setNames(lapply(vector("list", ncol(merged)), function(x) x <- -), names(merged))
myList <- setNames(lapply(vector("list", ncol(merged)), function(x) x <- 0), names(merged))
merged_test <- replace_na(merged, myList)
View(merged_test)
?replace
merged_test %>% replace(is.na(.), 0)
View(merged_test)
coalesce(merged_test, 0)
merged_test <- merged[is.na(merged)] = 0
merged_test[is.na(merged)] = 0
View(merged_test)
merged_test[is.na(merged_test)] = 0
View(merged_test)
merged_test[is.na(merged_test)]
merged_test[is.na(merged_test)] <- 0
View(merged_test)
View(myList)
View(merged)
View(myList)
merged
merged
merged_testPLZ <- merged
merged_testPLZ[is.na(merged_testPLZ)] <- 0
View(merged_testPLZ)
myList <- setNames(lapply(vector("list", ncol(merged_testPLZ)), function(x) x <- 0), names(merged_testPLZ))
merged_test <- merged_testPLZ %>% replace_na(myList)
View(merged_test)
?write.table
write.table(merged, file="./output/OCD_main_output.tsv", quote=FALSE, row.names = FALSE, sep="\t", na = "-")
reg_biotype <- regulatory_subset %>%  group_by(BIOTYPE) %>% summarise(counts = n_distinct(X.Uploaded_variation))
regulatory_subset <- subset(regulatory, select = c(X.Uploaded_variation, Location, Feature, Consequence, BIOTYPE, Promoter_histone_marks, Enhancer_histone_marks))
regulatory <- merged[merged$Feature_type == "RegulatoryFeature",]
View(regulatory)
reg_biotype <- regulatory_subset %>%  group_by(BIOTYPE) %>% summarise(counts = n_distinct(X.Uploaded_variation))
regulatory_subset <- subset(regulatory, select = c(X.Uploaded_variation, Location, Feature, Consequence, BIOTYPE, Promoter_histone_marks, Enhancer_histone_marks))
View(regulatory)
View(regulatory_subset)
reg_biotype <- regulatory_subset %>%  group_by(BIOTYPE) %>% summarise(counts = n_distinct(X.Uploaded_variation))
View(reg_biotype)
?ggplot
ggplot(reg_biotype ,aes(x = BIOTYPE, y = counts, fill = BIOTYPE)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Biotype of regulatory feature",
y = "Number of distinct rsIDs",
title = "Test plotting of regulatory features"
)
reg_bio_plot <- ggplot(reg_biotype ,aes(x = BIOTYPE, y = counts, fill = BIOTYPE)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Biotype of regulatory feature",
y = "Number of distinct rsIDs",
title = "Test plotting of regulatory features"
)
View(reg_bio_plot)
reg_bio_plot
saveRDS(reg_bio_plot, file = "./output/Plots/reg_bio.rds")
ggsave(filename = "./output/Plots/reg_bio.svg", plot = reg_bio_plot)
regulatory_subset %>%
group_by(Promoter_histone_marks) %>%
summarise(counts = n_distinct(X.Uploaded_variation))
df <- data.frame(month=rep(1:3,2),
student=rep(c("Amy", "Bob"), each=3),
A=c(9, 7, 6, 8, 6, 9),
B=c(6, 7, 8, 5, 6, 7))
View(df)
View(regulatory_subset)
reg_phistone <- separate_rows(regulatory_subset, Promoter_histone_marks, Enhancer_histone_marks)
reg_phistone <- separate_rows(regulatory_subset, Promoter_histone_marks)
View(reg_phistone)
reg_ehistone <- separate_rows(regulatory_subset, Enhancer_histone_marks)
View(reg_phistone)
View(reg_ehistone)
reg_phistone <- separate_rows(regulatory_subset, Promoter_histone_marks) %>% group_by(Promoter_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
View(reg_phistone)
reg_phist_plot <- ggplot(reg_phistone ,aes(x = Promoter_histone_marks, y = counts, fill = Promoter_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Promoter histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
View(reg_phist_plot)
saveRDS(reg_phist_plot, file = "./output/Plots/reg_phist.rds")
ggsave(filename = "./output/Plots/reg_phist.svg", plot = reg_phist_plot)
class(reg_phistone)
reg_phistone$Promoter_histone_marks
subset(reg_phistone, Promoter_histone_marks!="NA")
reg_phistone <- filter(reg_phistone, Promoter_histone_marks="NA", Promoter_histone_marks="")
View(reg_phistone)
reg_phistone[(!(reg_phistone$Promoter_histone_marks=="NA") & !(reg_phistone$Promoter_histone_marks=="")),]
reg_histone_filtered <- reg_phistone[(!(reg_phistone$Promoter_histone_marks=="NA") & !(reg_phistone$Promoter_histone_marks=="")),]
View(reg_histone_filtered)
reg_histone_filtered <- reg_phistone[(!(reg_phistone$Promoter_histone_marks=="")),]
reg_histone_filtered <- reg_phistone[(!(reg_phistone$Promoter_histone_marks=="NA") & !(reg_phistone$Promoter_histone_marks=="")),]
reg_phistone_filtered <- reg_phistone[(!(reg_phistone$Promoter_histone_marks=="NA") & !(reg_phistone$Promoter_histone_marks=="")),]
reg_phist_plot <- ggplot(reg_phistone_filtered ,aes(x = Promoter_histone_marks, y = counts, fill = Promoter_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Promoter histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
saveRDS(reg_phist_plot, file = "./output/Plots/reg_phist.rds")
ggsave(filename = "./output/Plots/reg_phist.svg", plot = reg_phist_plot)
reg_ehistone <- separate_rows(regulatory_subset, Enhancer_histone_marks) %>% group_by(Enhancer_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
reg_ehistone_filtered <- reg_ehistone[(!(reg_ehistone$Enhancer_histone_marks=="NA") & !(reg_histone$Enhancer_histone_marks=="")),]
reg_ehistone_filtered <- reg_ehistone[(!(reg_ehistone$Enhancer_histone_marks=="NA") & !(reg_ehistone$Enhancer_histone_marks=="")),]
reg_ehist_plot <- ggplot(reg_ehistone_filtered ,aes(x = Enhancer_histone_marks, y = counts, fill = Enhancer_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Enhancer histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
saveRDS(reg_ehist_plot, file = "./output/Plots/reg_ehist.rds")
ggsave(filename = "./output/Plots/reg_ehist.svg", plot = reg_ehist_plot)
reg_ehist_plot
write.table(reg_biotype, file="./output/reg_bio.tsv", quote=FALSE, row.names = FALSE, sep="\t")
write.table(reg_biotype, file="./output/summary/reg_bio.tsv", quote=FALSE, row.names = FALSE, sep="\t")
write.table(reg_phistone_filtered, file="./output/reg_phist.tsv", quote=FALSE, row.names = FALSE, sep="\t")
write.table(reg_ehistone_filtered, file="./output/reg_ehist.tsv", quote=FALSE, row.names = FALSE, sep="\t")
save.image("~/MSc/Project_3/MSc_Project3/scripts/pipeline_core/output/freezer/Workspace_before_cleanup.RData")
savehistory("~/MSc/Project_3/MSc_Project3/scripts/pipeline_core/output/freezer/Workspace_before_cleanup.Rhistory")
View(merged_testPLZ)
#Load rsIDs and vectorize for XGR:
snp_file <- read.table("./output/snp_file.txt", quote="\"", comment.char="")
library(XGR)
library(ggplot2)
library(svglite)
#Perform Enrichment
#NOt using SNPs in LD -> Add arg for selecting LD and threshold (-ld X)
#Will be taken by both HaploR and XGR.
#IN XGR transalate as xEnricherSNPs(..., include.LD=c("AFR", "AMR", "EAS", "EUR", "SAS"), LD.r2 = X)
enrichment <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=2, verbose=T, size.range=c(3,2000))
snp_INPUTVECTOR <- as.vector(snp_file[,1])
#Generate summary tables for Enrichment
write.table(enrichment_results, file="./output/enrichment_summary.tsv", quote=FALSE, row.names = FALSE, sep="\t")
library(XGR)
library(ggplot2)
library(svglite)
#ADD ARGS!!!!
#Load rsIDs and vectorize for XGR:
snp_file <- read.table("./output/snp_file.txt", quote="\"", comment.char="")
snp_INPUTVECTOR <- as.vector(snp_file[,1])
#Perform Enrichment
#NOt using SNPs in LD -> Add arg for selecting LD and threshold (-ld X)
#Will be taken by both HaploR and XGR.
#IN XGR transalate as xEnricherSNPs(..., include.LD=c("AFR", "AMR", "EAS", "EUR", "SAS"), LD.r2 = X)
enrichment <- xEnricherSNPs(snp_INPUTVECTOR, min.overlap=2, verbose=T, size.range=c(3,2000))
enrichment_results <- xEnrichViewer(enrichment, details = T)
#Generate summary tables for Enrichment
write.table(enrichment_results, file="./output/enrichment_summary.tsv", quote=FALSE, row.names = FALSE, sep="\t")
#Producing graphs. Either save as images (most probable) or save for report [future]
bar_plot <- xEnrichBarplot(enrichment, signature = FALSE)
dot_plot <- xEnrichDotplot(enrichment)
saveRDS(bar_plot, file = "./output/Plots/enrich_bar.rds")
saveRDS(dot_plot, file = "./output/Plots/enrich_dot.rds")
ggsave(filename = "./output/Plots/enrich_bar.svg", plot = bar_plot)
ggsave(filename = "./output/Plots/enrich_dot.svg", plot = dot_plot)
library(dplyr)
library(stringr)
library(ggplot2)
library(svglite)
#Loading full haploR ouput
haploR_output <- read.delim("./output/OCD_haploR.tsv", row.names = NULL)
#Working only with input SNPs: Filter out those found in LD
main_haploR <- haploR_output[haploR_output$is_query_snp == 1,]
#select only relevant fields
main_haploR <- subset(main_haploR, select = c(rsID, Proteins, eQTL, Promoter_histone_marks, Enhancer_histone_marks))
#Loading vep output: In .tsv format with --tab flag, skip to 58 to get only header and table
vep_output <- read.delim("./output/OCD.tsv", comment.char="", skip=58)
#Adding new column for rsID so that it can merged with haploR even if user input are coordinates
vep_output <- vep_output %>% dplyr::mutate(rsID = str_extract(Existing_variation, pattern = "rs\\d+(?=\\,|$)"))
merged <- left_join(vep_output, main_haploR, by=c("rsID"))
write.table(merged, file="./output/OCD_main_output.tsv", quote=FALSE, row.names = FALSE, sep="\t", na = "-")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#FROM plotting_and_summary rscript
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#First get reg table from main merged output:
regulatory <- merged[merged$Feature_type == "RegulatoryFeature",]
regulatory_subset <- subset(regulatory, select = c(X.Uploaded_variation, Location, Feature, Consequence, BIOTYPE, Promoter_histone_marks, Enhancer_histone_marks))
#Generating tables and plots:
#Generate pie chart with %of regulatory features vs total!
#Biotype
reg_biotype <- regulatory_subset %>%  group_by(BIOTYPE) %>% summarise(counts = n_distinct(X.Uploaded_variation))
write.table(reg_biotype, file="./output/reg_bio.tsv", quote=FALSE, row.names = FALSE, sep="\t")
reg_bio_plot <- ggplot(reg_biotype ,aes(x = BIOTYPE, y = counts, fill = BIOTYPE)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Biotype of regulatory feature",
y = "Number of distinct rsIDs",
title = "Test plotting of regulatory features"
)
saveRDS(reg_bio_plot, file = "./output/Plots/reg_bio.rds")
ggsave(filename = "./output/Plots/reg_bio.svg", plot = reg_bio_plot)
#P_histone
reg_phistone <- separate_rows(regulatory_subset, Promoter_histone_marks) %>% group_by(Promoter_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
reg_phistone_filtered <- reg_phistone[(!(reg_phistone$Promoter_histone_marks=="NA") & !(reg_phistone$Promoter_histone_marks=="")),]
write.table(reg_phistone_filtered, file="./output/reg_phist.tsv", quote=FALSE, row.names = FALSE, sep="\t")
reg_phist_plot <- ggplot(reg_phistone_filtered ,aes(x = Promoter_histone_marks, y = counts, fill = Promoter_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Promoter histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
saveRDS(reg_phist_plot, file = "./output/Plots/reg_phist.rds")
ggsave(filename = "./output/Plots/reg_phist.svg", plot = reg_phist_plot)
#E_histone
reg_ehistone <- separate_rows(regulatory_subset, Enhancer_histone_marks) %>% group_by(Enhancer_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
reg_ehistone_filtered <- reg_ehistone[(!(reg_ehistone$Enhancer_histone_marks=="NA") & !(reg_ehistone$Enhancer_histone_marks=="")),]
write.table(reg_ehistone_filtered, file="./output/reg_ehist.tsv", quote=FALSE, row.names = FALSE, sep="\t")
reg_ehist_plot <- ggplot(reg_ehistone_filtered ,aes(x = Enhancer_histone_marks, y = counts, fill = Enhancer_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Enhancer histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
saveRDS(reg_ehist_plot, file = "./output/Plots/reg_ehist.rds")
ggsave(filename = "./output/Plots/reg_ehist.svg", plot = reg_ehist_plot)
reg_bio_plot
reg_phistone <- separate_rows(regulatory_subset, Promoter_histone_marks) %>% group_by(Promoter_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
library(tidyr)
library(dplyr)
library(stringr)
library(ggplot2)
library(svglite)
#Loading full haploR ouput
haploR_output <- read.delim("./output/OCD_haploR.tsv", row.names = NULL)
#Working only with input SNPs: Filter out those found in LD
main_haploR <- haploR_output[haploR_output$is_query_snp == 1,]
#select only relevant fields
main_haploR <- subset(main_haploR, select = c(rsID, Proteins, eQTL, Promoter_histone_marks, Enhancer_histone_marks))
#Loading vep output: In .tsv format with --tab flag, skip to 58 to get only header and table
vep_output <- read.delim("./output/OCD.tsv", comment.char="", skip=58)
#Adding new column for rsID so that it can merged with haploR even if user input are coordinates
vep_output <- vep_output %>% dplyr::mutate(rsID = str_extract(Existing_variation, pattern = "rs\\d+(?=\\,|$)"))
merged <- left_join(vep_output, main_haploR, by=c("rsID"))
write.table(merged, file="./output/OCD_main_output.tsv", quote=FALSE, row.names = FALSE, sep="\t", na = "-")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#FROM plotting_and_summary rscript
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#First get reg table from main merged output:
regulatory <- merged[merged$Feature_type == "RegulatoryFeature",]
regulatory_subset <- subset(regulatory, select = c(X.Uploaded_variation, Location, Feature, Consequence, BIOTYPE, Promoter_histone_marks, Enhancer_histone_marks))
#Generating tables and plots:
#Generate pie chart with %of regulatory features vs total!
#Biotype
reg_biotype <- regulatory_subset %>%  group_by(BIOTYPE) %>% summarise(counts = n_distinct(X.Uploaded_variation))
write.table(reg_biotype, file="./output/reg_bio.tsv", quote=FALSE, row.names = FALSE, sep="\t")
reg_bio_plot <- ggplot(reg_biotype ,aes(x = BIOTYPE, y = counts, fill = BIOTYPE)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Biotype of regulatory feature",
y = "Number of distinct rsIDs",
title = "Test plotting of regulatory features"
)
saveRDS(reg_bio_plot, file = "./output/Plots/reg_bio.rds")
ggsave(filename = "./output/Plots/reg_bio.svg", plot = reg_bio_plot)
#P_histone
reg_phistone <- separate_rows(regulatory_subset, Promoter_histone_marks) %>% group_by(Promoter_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
reg_phistone_filtered <- reg_phistone[(!(reg_phistone$Promoter_histone_marks=="NA") & !(reg_phistone$Promoter_histone_marks=="")),]
write.table(reg_phistone_filtered, file="./output/reg_phist.tsv", quote=FALSE, row.names = FALSE, sep="\t")
reg_phist_plot <- ggplot(reg_phistone_filtered ,aes(x = Promoter_histone_marks, y = counts, fill = Promoter_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Promoter histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
saveRDS(reg_phist_plot, file = "./output/Plots/reg_phist.rds")
ggsave(filename = "./output/Plots/reg_phist.svg", plot = reg_phist_plot)
#E_histone
reg_ehistone <- separate_rows(regulatory_subset, Enhancer_histone_marks) %>% group_by(Enhancer_histone_marks) %>% summarise(counts = n_distinct(X.Uploaded_variation))
reg_ehistone_filtered <- reg_ehistone[(!(reg_ehistone$Enhancer_histone_marks=="NA") & !(reg_ehistone$Enhancer_histone_marks=="")),]
write.table(reg_ehistone_filtered, file="./output/reg_ehist.tsv", quote=FALSE, row.names = FALSE, sep="\t")
reg_ehist_plot <- ggplot(reg_ehistone_filtered ,aes(x = Enhancer_histone_marks, y = counts, fill = Enhancer_histone_marks)) +
geom_bar(stat = "identity") +
theme_classic() +
labs(
x = "Enhancer histone marks",
y = "Number of distinct rsIDs",
title = "Tissues from haploR"
)
saveRDS(reg_ehist_plot, file = "./output/Plots/reg_ehist.rds")
ggsave(filename = "./output/Plots/reg_ehist.svg", plot = reg_ehist_plot)
